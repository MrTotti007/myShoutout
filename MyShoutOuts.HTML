function shoutout() {
    // Parse URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const user = urlParams.get('user');
    const image = urlParams.get('image');
    const video = urlParams.get('video');
    const time = urlParams.get('time');
    document.getElementById('imagebox2').innerHTML = "<img src='" + image + "' width='100%'/>";
    
    // Always use the API to get the video source URL
    getVideoSourceFromAPI(video, function(videoSrc) {
        const videoElement = document.getElementById('videoplayer');
        videoElement.style.visibility = "hidden";
        videoElement.src = videoSrc;

        // Wait for the video to be ready before playing
        videoElement.addEventListener('canplaythrough', function handler() {
            videoElement.removeEventListener('canplaythrough', handler);
            showVideo();
        });

        videoElement.load();
    });
}

// Function to get video source URL from Twitch API
function getVideoSourceFromAPI(video, callback) {
    // Extract clip ID from the video URL
    const match = video.match(/clip=([^&]+)/);
    const clipId = match ? match[1] : null;

    if (!clipId) {
        console.error("Clip ID not found.");
        return;
    }

    const url = "https://gql.twitch.tv/gql";
    const query = {
        operationName: "VideoAccessToken_Clip",
        variables: {
            slug: clipId
        },
        extensions: {
            persistedQuery: {
                version: 1,
                sha256Hash: "36b89d2507fce29e5ca551df756d27c1cfe079e2609642b4390aa4c35796eb11"
            }
        }
    };

    var xhr = new XMLHttpRequest();
    xhr.open("POST", url, true); // Use asynchronous request
    xhr.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
    xhr.setRequestHeader("Client-ID", "kimne78kx3ncx6brgo4mv6wki5h1ko");
    xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                const clipInfo = JSON.parse(xhr.responseText);
                const clipData = clipInfo.data;
                const clipSource = clipData.clip.videoQualities[0].sourceURL;
                const clipSig = clipData.clip.playbackAccessToken.signature;
                const clipToken = clipData.clip.playbackAccessToken.value;
                const videoSrc = clipSource + "?sig=" + clipSig + "&token=" + encodeURIComponent(clipToken);
                callback(videoSrc);
            } else {
                console.error("Request failed with status: " + xhr.status);
            }
        }
    };
    xhr.send(JSON.stringify(query));
}
