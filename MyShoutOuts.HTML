<script>
    function shoutout() {
        const urlParams = new URLSearchParams(window.location.search);
        const user = urlParams.get('user');
        const image = urlParams.get('image');
        const video = urlParams.get('video');
        const time = urlParams.get('time');
        const thumbnailUrl = urlParams.get('thumbnail_url');

        // Display image
        document.getElementById('imagebox2').innerHTML = `<img src="${image}" width="100%">`;

        // Generate video source
        let videoSrc = thumbnailUrl.replace(/(.*)-preview-.*/, '$1.mp4');

        // OBS-specific adjustments for Twitch GraphQL fetch
        if (!thumbnailUrl.includes("-preview-")) {
            const clipIdMatch = video.match(/clip=([^"]+)/);
            const clipId = clipIdMatch ? clipIdMatch[1] : null;

            if (clipId) {
                const gqlUrl = "https://gql.twitch.tv/gql";
                const query = {
                    operationName: "VideoAccessToken_Clip",
                    variables: { slug: clipId },
                    extensions: {
                        persistedQuery: {
                            version: 1,
                            sha256Hash: "36b89d2507fce29e5ca551df756d27c1cfe079e2609642b4390aa4c35796eb11"
                        }
                    }
                };

                const xhr = new XMLHttpRequest();
                xhr.open("POST", gqlUrl, false);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Client-ID", "kimne78kx3ncx6brgo4mv6wki5h1ko");
                xhr.send(JSON.stringify(query));

                if (xhr.status === 200) {
                    const response = JSON.parse(xhr.responseText);
                    const clipData = response.data.clip;
                    const clipSource = clipData.videoQualities[0].sourceURL;
                    const clipSig = clipData.playbackAccessToken.signature;
                    const clipToken = clipData.playbackAccessToken.value;
                    videoSrc = `${clipSource}?sig=${clipSig}&token=${clipToken}`;
                } else {
                    console.error("Error fetching video source");
                    return;
                }
            }
        }

        const videoElement = document.getElementById('videoplayer');
        videoElement.src = videoSrc;
        videoElement.style.visibility = "hidden";

        // OBS-Specific Preload and Play Handling
        videoElement.addEventListener('canplay', function onCanPlay() {
            videoElement.removeEventListener('canplay', onCanPlay);
            videoElement.style.visibility = "visible";
            videoElement.play();
        });

        videoElement.load();
    }

    function cleanup() {
        document.getElementById('videocontainer').innerHTML = "";
        document.getElementById('imagebox2').innerHTML = "";
    }
</script>
